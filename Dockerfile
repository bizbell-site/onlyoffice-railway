FROM onlyoffice/documentserver:latest                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                      
RUN mv /etc/init.d/nginx /etc/init.d/nginx.orig && \                                                                                                                                                                                                                                  
    printf '#!/bin/bash\necho "=== NGINX CONFIGS ==="\ncat /etc/nginx/conf.d/ds.conf 2>/dev/null || echo "ds.conf not found"\necho "=== MODIFYING CONFIGS ==="\nfor f in /etc/nginx/conf.d/*.conf /etc/nginx/sites-enabled/*; do\n  [ -f "$f" ] && sed -i "s/listen 80;/listen 0.0.0.0:80;/g" "$f"\n  [ -f "$f" ] && sed -i "s/listen \\[::]:80;/#listen [::]:80;/g" "$f"\ndone\necho "=== MODIFIED CONFIG ==="\ncat /etc/nginx/conf.d/ds.conf 2>/dev/null\necho "=== STARTING NGINX ==="\n/etc/init.d/nginx.orig "$@"\nRET=$?\necho "=== NGINX EXIT CODE: $RET==="\nnginx -t 2>&1\nexit $RET\n' > /etc/init.d/nginx && \                                                                                                                                                                                                                            
    chmod +x /etc/init.d/nginx                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                      
EXPOSE 80
